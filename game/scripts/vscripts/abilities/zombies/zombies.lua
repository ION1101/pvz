LinkLuaModifier( "modifier_zombie", "modifiers/modifier_zombie.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_1_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_2_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_3_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_4_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_5_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_6_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_7_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_4_2_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_5_2_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_6_2_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_7_2_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_4_3_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_5_3_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_6_3_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_spawn_7_3_checker", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_1_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_2_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_3_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_4_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_5_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_6_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_7_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_4_2_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_5_2_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_6_2_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_7_2_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_4_3_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_5_3_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_6_3_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_7_3_attacks", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "z_modifier_smelly", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_zombie_autoattack", "modifiers/modifier_zombie.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_cannon_arrived", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_cannon", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_disable_turning", "modifiers/modifier_disable_turning.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_cannon_3", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_cannon_4", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_cannon_5", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_flying_zombie", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_gargantua_flower_aura", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_zombie_dancing", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_zombie_poison", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_zombie_dog", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_zombie_dog_comeback", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_pharaon_spawn", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_zombie_ninja", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_fear_scream", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )

LinkLuaModifier( "modifier_tombestone_cd", "zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
--[[
LinkLuaModifier( "modifier_zombie_autoattack", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_zombie_autoattack", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_zombie_autoattack", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
LinkLuaModifier( "modifier_zombie_autoattack", "abilities/zombies/zombies.lua", LUA_MODIFIER_MOTION_NONE )
]]
-------------------------------- ATTACKER 1 SPELL ----------------------
z_1_attack = class({})

function z_1_attack:GetIntrinsicModifierName()
	return "z_modifier_1_attacks"
end

z_modifier_1_attacks = class({})

function z_modifier_1_attacks:IsHidden() return true end
function z_modifier_1_attacks:IsBuff() return true end
function z_modifier_1_attacks:OnCreated()
if not IsServer() then return end
	--self.gold = self:GetAbility():GetSpecialValueFor("gold_per_attack")
	local gpm = self:GetAbility():GetSpecialValueFor("gpm")
	local targets = FindUnitsInRadius(self:GetParent():GetTeamNumber(), self:GetParent():GetAbsOrigin(), nil, FIND_UNITS_EVERYWHERE, DOTA_UNIT_TARGET_TEAM_FRIENDLY, DOTA_UNIT_TARGET_ALL, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES + DOTA_UNIT_TARGET_FLAG_NOT_MAGIC_IMMUNE_ALLIES + DOTA_UNIT_TARGET_FLAG_INVULNERABLE + DOTA_UNIT_TARGET_FLAG_NOT_ATTACK_IMMUNE, 0, false)
	for _,target in pairs(targets) do
		if target:GetUnitName()=="npc_dota_zombies_lab" then
			local extra_gold = 0			
			extra_gold = target:FindAbilityByName("zombies_lab_gold_multiply"):GetSpecialValueFor("g_multiply")			
			self.gpm = gpm + (gpm * (extra_gold / 100))
		break
		end
	end
	--local interval = 60/gpm
	self:StartIntervalThink(1)
end
function z_modifier_1_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE_MIN,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE,
		MODIFIER_PROPERTY_IGNORE_MOVESPEED_LIMIT,
		MODIFIER_PROPERTY_MOVESPEED_LIMIT
	}
end
function z_modifier_1_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end
function z_modifier_1_attacks:OnIntervalThink()
if IsServer() then
		self:OnCreated()
		local allHeroes = HeroList:GetAllHeroes()
		for k, v in pairs( allHeroes ) do
			if v:GetUnitName()=="npc_dota_hero_undying" then
				--if v:HasModifier("modifier_solo_player") then v:ModifyGold(2, true, 1)
				--else 
				v:ModifyGold(self.gpm/60, true, 1)
				--end
			end
		end
end
end
function z_modifier_1_attacks:GetModifierIgnoreMovespeedLimit() return 1 end
function z_modifier_1_attacks:GetModifierMoveSpeed_Absolute() return 100 end
function z_modifier_1_attacks:GetModifierMoveSpeed_AbsoluteMin() return 100 end
function z_modifier_1_attacks:GetModifierMoveSpeed_Limit() return 100 end

---------------------------  1 SPAWN ABILITY -------------------------
zombie_spawn_1 = class({})

function zombie_spawn_1:GetIntrinsicModifierName()
	return "modifier_spawn_1_checker"
end

function zombie_spawn_1:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_1"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end  
	end

	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_1 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_1:SetInitialGoalEntity( waypointlocation )
	zombie_1:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_1:SetIdleAcquire(false)
	zombie_1:FindAbilityByName("z_1_attack"):SetLevel(1)

end

modifier_spawn_1_checker = class({})

function modifier_spawn_1_checker:IsHidden() return true end
function modifier_spawn_1_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_1_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	--local tomb = self:GetParent():HasModifier("modifier_tomb1")
	--if tomb then tomb = "tomb 1" else tomb = "tomb 2" end
	--local owner = self:GetParent():GetOwner():HasModifier("modifier_main_undying")
	--if owner then owner = "zombie 1" else owner = "zombie 2" end
	--print(tomb.."  "..owner)
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
--				--									==============
--				--									==         ===
--				--											===
--				--										 ===
--				--									  ===		 ==
--				--									===============
--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================

--------------------------- ATTACKER 2 SPAWN ABILITY -------------------------
zombie_spawn_2 = class({})

function zombie_spawn_2:GetIntrinsicModifierName()
	return "modifier_spawn_2_checker"
end

function zombie_spawn_2:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_2"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""
	
	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end  
	end

	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_attacker_1 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_attacker_1:SetInitialGoalEntity( waypointlocation )
	zombie_attacker_1:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_attacker_1:SetIdleAcquire(false)
	zombie_attacker_1:FindAbilityByName("z_2_attack"):SetLevel(1)
end

modifier_spawn_2_checker = class({})

function modifier_spawn_2_checker:IsHidden() return true end
function modifier_spawn_2_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_2_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 2 SPELL ----------------------
z_2_attack = class({})

function z_2_attack:GetIntrinsicModifierName()
	return "z_modifier_2_attacks"
end

z_modifier_2_attacks = class({})

function z_modifier_2_attacks:IsHidden() return true end
function z_modifier_2_attacks:IsBuff() return true end
function z_modifier_2_attacks:OnCreated()
if IsServer() then
	--self.gold = self:GetAbility():GetSpecialValueFor("gold_per_attack")
	local gpm = self:GetAbility():GetSpecialValueFor("gpm")
	local targets = FindUnitsInRadius(self:GetParent():GetTeamNumber(), self:GetParent():GetAbsOrigin(), nil, FIND_UNITS_EVERYWHERE, DOTA_UNIT_TARGET_TEAM_FRIENDLY, DOTA_UNIT_TARGET_ALL, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES + DOTA_UNIT_TARGET_FLAG_NOT_MAGIC_IMMUNE_ALLIES + DOTA_UNIT_TARGET_FLAG_INVULNERABLE + DOTA_UNIT_TARGET_FLAG_NOT_ATTACK_IMMUNE, 0, false)
	for _,target in pairs(targets) do
		if target:GetUnitName()=="npc_dota_zombies_lab" then
			local extra_gold = 0			
			extra_gold = target:FindAbilityByName("zombies_lab_gold_multiply"):GetSpecialValueFor("g_multiply")
						
			self.gpm = gpm + (gpm * (extra_gold / 100))
			--print("gpm is"..gpm)
		break
		end
	end
	--local interval = 60/gpm
	self:StartIntervalThink(1)

end
end
function z_modifier_2_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE_MIN,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE,
		MODIFIER_PROPERTY_IGNORE_MOVESPEED_LIMIT,
		MODIFIER_PROPERTY_MOVESPEED_LIMIT
	}
end
function z_modifier_2_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end
function z_modifier_2_attacks:OnIntervalThink()
if IsServer() then
	self:OnCreated()
	local allHeroes = HeroList:GetAllHeroes()
	for k, v in pairs( allHeroes ) do
		if v:GetUnitName()=="npc_dota_hero_undying" then
				--if v:HasModifier("modifier_solo_player") then v:ModifyGold(2, true, 1)
				--else 
				v:ModifyGold(self.gpm/60, true, 1)
				--end
		end
	end

end
end
function z_modifier_2_attacks:GetModifierIgnoreMovespeedLimit() return 1 end
function z_modifier_2_attacks:GetModifierMoveSpeed_Absolute() return 100 end
function z_modifier_2_attacks:GetModifierMoveSpeed_AbsoluteMin() return 100 end
function z_modifier_2_attacks:GetModifierMoveSpeed_Limit() return 100 end
--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
--				--									==============
--				--									=          ===
--				--											   ===
--				--									    ==========
--				--											   ===
--				--									=		   ===
--				--									==============
--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
--------------------------- ATTACKER 3 SPAWN ABILITY -------------------------
zombie_spawn_3 = class({})

function zombie_spawn_3:GetIntrinsicModifierName()
	return "modifier_spawn_3_checker"
end

function zombie_spawn_3:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_3"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end  
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_3 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_3:SetInitialGoalEntity( waypointlocation )
	zombie_3:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_3:SetIdleAcquire(false)
	zombie_3:FindAbilityByName("z_3_attack"):SetLevel(1)
	zombie_3:SetRenderColor(116, 96, 38) --[[Returns:void
	SetRenderColor( r, g, b ): Sets the render color of the entity.
	]]
end

modifier_spawn_3_checker = class({})

function modifier_spawn_3_checker:IsHidden() return true end
function modifier_spawn_3_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_3_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 3 SPELL ----------------------
z_3_attack = class({})

function z_3_attack:GetIntrinsicModifierName()
	return "z_modifier_3_attacks"
end

z_modifier_3_attacks = class({})

function z_modifier_3_attacks:IsHidden() return true end
function z_modifier_3_attacks:IsBuff() return true end
function z_modifier_3_attacks:OnCreated()
if not IsServer() then return end
	local gpm = self:GetAbility():GetSpecialValueFor("gpm")
	local targets = FindUnitsInRadius(self:GetParent():GetTeamNumber(), self:GetParent():GetAbsOrigin(), nil, FIND_UNITS_EVERYWHERE, DOTA_UNIT_TARGET_TEAM_FRIENDLY, DOTA_UNIT_TARGET_ALL, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES + DOTA_UNIT_TARGET_FLAG_NOT_MAGIC_IMMUNE_ALLIES + DOTA_UNIT_TARGET_FLAG_INVULNERABLE + DOTA_UNIT_TARGET_FLAG_NOT_ATTACK_IMMUNE, 0, false)
	for _,target in pairs(targets) do
		if target:GetUnitName()=="npc_dota_zombies_lab" then
			local extra_gold = 0				
			extra_gold = target:FindAbilityByName("zombies_lab_gold_multiply"):GetSpecialValueFor("g_multiply")
						
			self.gpm = gpm + (gpm * (extra_gold / 100))
			--print("gpm is"..gpm)
		break
		end
	end
	--local interval = 60/gpm
	self:StartIntervalThink(1)
end
function z_modifier_3_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE_MIN,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE,
		MODIFIER_PROPERTY_IGNORE_MOVESPEED_LIMIT,
		MODIFIER_PROPERTY_MOVESPEED_LIMIT
	}
end
function z_modifier_3_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end
function z_modifier_3_attacks:OnIntervalThink()
if IsServer() then
	self:OnCreated()	
	local allHeroes = HeroList:GetAllHeroes()
	for k, v in pairs( allHeroes ) do
		if v:GetUnitName()=="npc_dota_hero_undying" then
				--if v:HasModifier("modifier_solo_player") then v:ModifyGold(2, true, 1)
				--else 
				v:ModifyGold(self.gpm/60, true, 1)
				--end
		end
	end
end
end
function z_modifier_3_attacks:GetModifierIgnoreMovespeedLimit() return 1 end
function z_modifier_3_attacks:GetModifierMoveSpeed_Absolute() return 300 end
function z_modifier_3_attacks:GetModifierMoveSpeed_AbsoluteMin() return 300 end
function z_modifier_3_attacks:GetModifierMoveSpeed_Limit() return 300 end

--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
--				--									==          ==
--				--									==          ==
--				--									==		    ==
--				--									==============
--				--											   ===
--				--											   ===
--				--											   ===
--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
--------------------------- ATTACKER 4 SPAWN ABILITY -------------------------
zombie_spawn_4_1 = class({})

function zombie_spawn_4_1:GetIntrinsicModifierName()
	return "modifier_spawn_4_checker"
end

function zombie_spawn_4_1:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_4"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end  
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_4 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_4:SetInitialGoalEntity( waypointlocation )
	zombie_4:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_4:AddNewModifier(zombie_4, self, "z_modifier_smelly", {})
	zombie_4:SetIdleAcquire(false)
	zombie_4:FindAbilityByName("z_4_attack"):SetLevel(1)
end

modifier_spawn_4_checker = class({})

function modifier_spawn_4_checker:IsHidden() return true end
function modifier_spawn_4_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_4_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 4 SPELL ----------------------
z_4_attack = class({})

function z_4_attack:GetIntrinsicModifierName()
	return "z_modifier_4_attacks"
end

z_modifier_4_attacks = class({})

function z_modifier_4_attacks:IsHidden() return true end
function z_modifier_4_attacks:IsBuff() return true end
function z_modifier_4_attacks:IsPurgable() return false end


z_modifier_smelly = class({})

function z_modifier_smelly:IsAura()
	if self:GetCaster() == self:GetParent() then
		return true
	end	
	return false
end
function z_modifier_smelly:IsHidden() return false end
function z_modifier_smelly:GetTexture() return "pudge_rot" end
function z_modifier_smelly:IsBuff() if self:GetCaster()==self:GetParent() then return true else return false end end
function z_modifier_smelly:IsPurgable() return false end
function z_modifier_smelly:RemoveOnDeath() return true end
function z_modifier_smelly:GetModifierAura()
	return "z_modifier_smelly"
end

function z_modifier_smelly:GetAuraSearchTeam()
	return DOTA_UNIT_TARGET_TEAM_ENEMY
end
function z_modifier_smelly:GetAuraSearchType()
	return DOTA_UNIT_TARGET_ALL
end

function z_modifier_smelly:GetAuraRadius()
	return 150--self:GetAbility():GetSpecialValueFor("radius")
end

function z_modifier_smelly:OnCreated()

	if self:GetParent()==self:GetCaster() then EmitSoundOn( "Hero_Pudge.Rot", self:GetParent() ) end
	self.radius = 150--self:GetAbility():GetSpecialValueFor( "radius" )
	self.damage = 10--self:GetAbility():GetSpecialValueFor( "dmg" )
	if self:GetParent():GetUnitName()=="npc_summon_7_2" then self.damage = 15 end
	self.tick = 0.2--self:GetAbility():GetSpecialValueFor( "interval" )
	local nFXIndex = ParticleManager:CreateParticle( "particles/units/heroes/hero_pudge/pudge_rot.vpcf", PATTACH_ABSORIGIN_FOLLOW, self:GetParent() )
	ParticleManager:SetParticleControl( nFXIndex, 1, Vector( self.radius, 1, self.radius ) )
	self:AddParticle( nFXIndex, false, false, -1, false, false )
	self:StartIntervalThink(self.tick)
end

function z_modifier_smelly:OnIntervalThink()
	if IsServer() then

		if self:GetCaster()==self:GetParent() then
			local caster = self:GetParent()
			local targets = FindUnitsInRadius(caster:GetTeamNumber(), caster:GetAbsOrigin(), nil, self.radius, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_ALL, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES, 0, false)
			local lines = pvzGameMode:GetLines()

			for _,target in pairs(targets) do
				for i = 1, lines do
					if caster:HasModifier("modifier_line_"..i) and target:HasModifier("modifier_line_"..i) then -- если рядом трава с нужной линии

						if target:HasModifier("modifier_plants") or target:GetUnitName()=="npc_dota_creature_fence" then 
							local flDamagePerTick = self.tick * self.damage
		
							if caster:IsAlive() then
								local damage = {
									victim = target,
									attacker = caster,
									damage = flDamagePerTick,
									damage_type = DAMAGE_TYPE_PURE,
									ability = self:GetAbility()
								}

								ApplyDamage( damage )
							end
						end
					end
				end  
			end
		if not self:GetParent():IsAlive() then StopSoundOn( "Hero_Pudge.Rot", self:GetParent() ) end
		end
	end
end
function z_modifier_smelly:OnDestroy()
	StopSoundOn( "Hero_Pudge.Rot", self:GetParent() )
end
function z_modifier_smelly:OnDeath()
	StopSoundOn( "Hero_Pudge.Rot", self:GetParent() )
end

function z_modifier_4_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED
	}
end
function z_modifier_4_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end




zombie_spawn_4_2 = class({})

function zombie_spawn_4_2:GetIntrinsicModifierName()
	return "modifier_spawn_4_2_checker"
end

function zombie_spawn_4_2:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_4_2"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""
	

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end  
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_4 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_4:SetInitialGoalEntity( waypointlocation )
	zombie_4:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_4:SetIdleAcquire(false)
	zombie_4:FindAbilityByName("z_4_2_attack"):SetLevel(1)
end

modifier_spawn_4_2_checker = class({})

function modifier_spawn_4_2_checker:IsHidden() return true end
function modifier_spawn_4_2_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_4_2_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 4 SPELL ----------------------
z_4_2_attack = class({})

function z_4_2_attack:GetIntrinsicModifierName()
	return "z_modifier_4_2_attacks"
end

z_modifier_4_2_attacks = class({})

function z_modifier_4_2_attacks:IsHidden() return true end
function z_modifier_4_2_attacks:IsBuff() return true end
function z_modifier_4_2_attacks:IsPurgable() return false end


function z_modifier_4_2_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_EVENT_ON_TAKEDAMAGE
	}
end
function z_modifier_4_2_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end
function z_modifier_4_2_attacks:OnTakeDamage(event)
if not self:GetAbility():IsCooldownReady() then return end
	local caster = self:GetParent()
	local limit = self:GetAbility():GetSpecialValueFor("hp_limit")
	local duration = self:GetAbility():GetSpecialValueFor("duration")

	local pct_hp = caster:GetHealth() / caster:GetMaxHealth()*100
	
	--print("Reincarnate")
	if pct_hp <= limit and not caster:HasModifier("modifier_winter_wyvern_cold_embrace") then
		caster:AddNewModifier(caster, self:GetAbility(), "modifier_winter_wyvern_cold_embrace", {duration = duration})
		self:GetAbility():UseResources(false, false, false, true)
		EmitSoundOn("Hero_Winter_Wyvern.ColdEmbrace.Cast", caster)
	end
	
end



zombie_spawn_4_3 = class({})

function zombie_spawn_4_3:GetIntrinsicModifierName()
	return "modifier_spawn_4_3_checker"
end

function zombie_spawn_4_3:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_4_3"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end  
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_4 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_4:SetInitialGoalEntity( waypointlocation )
	zombie_4:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_4:SetIdleAcquire(false)
	zombie_4:FindAbilityByName("z_4_3_attack"):SetLevel(1)
end

modifier_spawn_4_3_checker = class({})

function modifier_spawn_4_3_checker:IsHidden() return true end
function modifier_spawn_4_3_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_4_3_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 4 SPELL ----------------------
z_4_3_attack = class({})

function z_4_3_attack:GetIntrinsicModifierName()
	return "z_modifier_4_3_attacks"
end

z_modifier_4_3_attacks = class({})

function z_modifier_4_3_attacks:IsHidden() return true end
function z_modifier_4_3_attacks:IsBuff() return true end
function z_modifier_4_3_attacks:IsPurgable() return false end


function z_modifier_4_3_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED
	}
end
function z_modifier_4_3_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end


--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
--				--									==============
--				--									==           
--				--									==
--				--									==============
--				--											    ==
--				--											    ==
--				--									==============
--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
zombie_spawn_5_1 = class({})

function zombie_spawn_5_1:GetIntrinsicModifierName()
	return "modifier_spawn_5_checker"
end

function zombie_spawn_5_1:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_5"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_attacker_5 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_attacker_5:SetInitialGoalEntity( waypointlocation )
	zombie_attacker_5:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_attacker_5:SetIdleAcquire(false)
	zombie_attacker_5:FindAbilityByName("z_5_attack"):SetLevel(1)
end

modifier_spawn_5_checker = class({})

function modifier_spawn_5_checker:IsHidden() return true end
function modifier_spawn_5_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_5_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 5 SPELL ----------------------
z_5_attack = class({})

function z_5_attack:GetIntrinsicModifierName()
	return "z_modifier_5_attacks"
end

z_modifier_5_attacks = class({})

function z_modifier_5_attacks:IsHidden() return true end
function z_modifier_5_attacks:IsBuff() return true end
function z_modifier_5_attacks:OnCreated()
	self:StartIntervalThink(0.2)
end
function z_modifier_5_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED
	}
end
function z_modifier_5_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end

function z_modifier_5_attacks:OnIntervalThink()
if IsServer() then	
	local caster = self:GetParent()
	if self:GetAbility():IsCooldownReady() then
		local targets = FindUnitsInRadius(caster:GetTeamNumber(), caster:GetAbsOrigin(), nil, 100, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_ALL, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES, 0, false)
		local lines = pvzGameMode:GetLines()

		for _,target in pairs(targets) do
			if self:GetAbility():IsCooldownReady() then
			for i = 1, lines do
				if caster:HasModifier("modifier_line_"..i) and target:HasModifier("modifier_line_"..i) then -- если рядом трава с нужной линии

					if target:HasModifier("modifier_plants") then 
						
					local flower_location = target:GetAbsOrigin()
					local zombie_location = caster:GetAbsOrigin()
						
					local direction = (flower_location - zombie_location):Normalized() -- вектор между цветком и зомбаком
					local direction_flower = (zombie_location - flower_location):Normalized() -- вектор между зомбаком и цветком
					local forward_vector = target:GetForwardVector()  -- направление взгляда зомбака
					local forward_vector_flower = caster:GetForwardVector() -- направление взгляда зомбака
					local angle = math.abs(RotationDelta((VectorToAngles(direction)), VectorToAngles(forward_vector)).y) -- угол между цветком и зомби

				--local angle_flower = math.abs(RotationDelta((VectorToAngles(direction_flower)), VectorToAngles(forward_vector_flower)).y) -- угол между зомби и цветком

				--print("Angle: " .. angle)
				--print("Angle: zombie" .. angle_flower)


				if angle>30 then
						--print("allow to jump")
						caster:Stop()
						ProjectileManager:ProjectileDodge(caster)
						caster:AddNewModifier(caster, nil, "modifier_zombie_autoattack", {})
						caster:AddNewModifier(caster, self:GetAbility(), "modifier_mirana_leap", {})

						self.particle_jump = ParticleManager:CreateParticle("particles/items_fx/pogo_stick.vpcf", PATTACH_ABSORIGIN_FOLLOW, self:GetParent())
						ParticleManager:SetParticleControl(self.particle_jump, 0,self:GetParent():GetAbsOrigin())
						ParticleManager:SetParticleControl(self.particle_jump, 1, self:GetParent():GetAbsOrigin())

						self:GetAbility():UseResources(true,false,true,true)

					end
				end
				end
			end
			end  
		end
	end
end
end


----------------------------------------------------000000000--------------------------------------------------------------------------------------------
---------------------------------------------------------00-------------------------------------------------------------------------------
----------------------------------------------------000000000---------------------------------------------------------------------------------------


zombie_spawn_5_2 = class({})

function zombie_spawn_5_2:GetIntrinsicModifierName()
	return "modifier_spawn_5_2_checker"
end

function zombie_spawn_5_2:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_5_2"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_attacker_5 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_attacker_5:SetInitialGoalEntity( waypointlocation )
	zombie_attacker_5:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_attacker_5:SetIdleAcquire(false)
	zombie_attacker_5:FindAbilityByName("z_5_2_attack"):SetLevel(1)
end

modifier_spawn_5_2_checker = class({})

function modifier_spawn_5_2_checker:IsHidden() return true end
function modifier_spawn_5_2_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_5_2_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 5 SPELL ----------------------
z_5_2_attack = class({})

function z_5_2_attack:GetIntrinsicModifierName()
	return "z_modifier_5_2_attacks"
end

z_modifier_5_2_attacks = class({})

function z_modifier_5_2_attacks:IsHidden() return true end
function z_modifier_5_2_attacks:IsBuff() return true end

function z_modifier_5_2_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_PROPERTY_PROCATTACK_FEEDBACK
	}
end
function z_modifier_5_2_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end

function z_modifier_5_2_attacks:GetModifierProcAttack_Feedback(params)

	local target = params.target
	if not target:HasModifier("modifier_zombie_poison") then
		local modifier = target:AddNewModifier(target, self:GetAbility(), "modifier_zombie_poison", {})
		modifier:SetStackCount(2)
	else 
		local stack_count = target:GetModifierStackCount("modifier_zombie_poison", target)
		--target:RemoveModifierByName("modifier_zombie_poison")
		--target:AddNewModifier(self:GetParent(), self:GetAbility(), "modifier_zombie_poison", {})
		target:SetModifierStackCount("modifier_zombie_poison", target, stack_count + 2)
	end

end


modifier_zombie_poison = class({})
function modifier_zombie_poison:GetTexture() return "zombies/ability5_2" end
modifier_zombie_poison.OnRefresh = modifier_zombie_poison.OnCreated
function modifier_zombie_poison:IsDebuff() return true end
function modifier_zombie_poison:IsHidden() return false end
function modifier_zombie_poison:OnCreated()
 	self:StartIntervalThink(1)
 	self:OnIntervalThink()
 end 
function modifier_zombie_poison:OnIntervalThink()
if IsServer() then
	local damage = self:GetStackCount()
	local damage_table = {
		victim = self:GetParent(),
		attacker = self:GetParent(),
		damage = damage,
		damage_type = DAMAGE_TYPE_PURE
	}
	ApplyDamage( damage_table )
end
end
function modifier_zombie_poison:DeclareFunctions()
	return {
		--MODIFIER_PROPERTY_HEALTH_REGEN_CONSTANT,
		--MODIFIER_PROPERTY_HP_REGEN_CAN_BE_NEGATIVE
	}
end
--function modifier_zombie_poison:GetModifierConstantHealthRegen() return self:GetStackCount()*(-1) end
--function modifier_zombie_poison:GetModifierHPRegen_CanBeNegative() return 1 end
function modifier_zombie_poison:GetEffectName() return "particles/units/heroes/hero_viper/viper_poison_debuff.vpcf" end
function modifier_zombie_poison:GetEffectAttachType() return PATTACH_ABSORIGIN_FOLLOW end

--==========================================================================================
--==========================================================================================
--==========================================================================================

zombie_spawn_5_3 = class({})

function zombie_spawn_5_3:GetIntrinsicModifierName()
	return "modifier_spawn_5_3_checker"
end

function zombie_spawn_5_3:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_5_3"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""
	

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_attacker_5 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_attacker_5:SetInitialGoalEntity( waypointlocation )
	zombie_attacker_5:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_attacker_5:SetIdleAcquire(false)
	zombie_attacker_5:FindAbilityByName("z_5_3_attack"):SetLevel(1)
end

modifier_spawn_5_3_checker = class({})

function modifier_spawn_5_3_checker:IsHidden() return true end
function modifier_spawn_5_3_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_5_3_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()		
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 5 SPELL ----------------------
z_5_3_attack = class({})

function z_5_3_attack:GetIntrinsicModifierName()
	return "z_modifier_5_3_attacks"
end

z_modifier_5_3_attacks = class({})

function z_modifier_5_3_attacks:IsHidden() return true end
function z_modifier_5_3_attacks:IsBuff() return true end

function z_modifier_5_3_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_PROPERTY_PROCATTACK_FEEDBACK,
		MODIFIER_PROPERTY_EVASION_CONSTANT
	}
end
function z_modifier_5_3_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end
function z_modifier_5_3_attacks:GetModifierEvasion_Constant() return 15 end
function z_modifier_5_3_attacks:GetModifierProcAttack_Feedback(params)

	local caster = params.attacker
	if not caster:HasModifier("modifier_zombie_ninja") then
		local modifier = caster:AddNewModifier(caster, self:GetAbility(), "modifier_zombie_ninja", {})
		modifier:SetStackCount(1)
	else 
		local stack_count = caster:GetModifierStackCount("modifier_zombie_ninja", caster)
		--target:RemoveModifierByName("modifier_zombie_poison")
		--target:AddNewModifier(self:GetParent(), self:GetAbility(), "modifier_zombie_poison", {})
		caster:SetModifierStackCount("modifier_zombie_ninja", caster, stack_count + 1)
	end

end


modifier_zombie_ninja = class({})
function modifier_zombie_ninja:GetTexture() return "troll_warlord_fervor" end
modifier_zombie_ninja.OnRefresh = modifier_zombie_ninja.OnCreated
function modifier_zombie_ninja:IsHidden() return false end
function modifier_zombie_ninja:IsBuff() return true end
function modifier_zombie_ninja:DeclareFunctions()
	return {
		MODIFIER_PROPERTY_ATTACKSPEED_BONUS_CONSTANT
	}
end
function modifier_zombie_ninja:GetModifierAttackSpeedBonus_Constant() return self:GetStackCount() * 15 end

--==================================================================================================================
--==================================================================================================================
--==================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
--				--									==============
--				--									==           
--				--									==
--				--									==============
--				--									==		    ==
--				--									==		    ==
--				--									==============
--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================

--------------------------------------------------------------
---------------------------------------------------------00-------------------------------------------------------------------------------
----------------------------------------------------000000000---------------------------------------------------------------------------------------


zombie_spawn_6_2 = class({})

function zombie_spawn_6_2:GetIntrinsicModifierName()
	return "modifier_spawn_6_2_checker"
end

function zombie_spawn_6_2:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_6_2"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_dancer = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_glasses.vmdl"}):FollowEntity(zombie_dancer, true)
	SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_wig.vmdl"}):FollowEntity(zombie_dancer, true)
	SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_armor.vmdl"}):FollowEntity(zombie_dancer, true)
	SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_arms.vmdl"}):FollowEntity(zombie_dancer, true)
	zombie_dancer:SetInitialGoalEntity( waypointlocation )
	zombie_dancer:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_dancer:SetIdleAcquire(false)
	zombie_dancer:FindAbilityByName("z_6_2_attack"):SetLevel(1)
end

modifier_spawn_6_2_checker = class({})

function modifier_spawn_6_2_checker:IsHidden() return true end
function modifier_spawn_6_2_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_6_2_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()		
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 5 SPELL ----------------------
z_6_2_attack = class({})

function z_6_2_attack:GetIntrinsicModifierName()
	return "z_modifier_6_2_attacks"
end

z_modifier_6_2_attacks = class({})

function z_modifier_6_2_attacks:IsHidden() return true end
function z_modifier_6_2_attacks:IsBuff() return true end
function z_modifier_6_2_attacks:OnCreated()
	self:StartIntervalThink(0.1)
end
function z_modifier_6_2_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED
		--MODIFIER_PROPERTY_OVERRIDE_ANIMATION
	}
end
function z_modifier_6_2_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end

function z_modifier_6_2_attacks:OnIntervalThink()
if IsServer() then
if self:GetAbility():IsCooldownReady() then
	local start_dance = false
	local caster = self:GetParent()
	
	local targets = FindUnitsInRadius(caster:GetTeamNumber(), caster:GetAbsOrigin(), nil, 1000, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_BASIC, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES, 0, false)
	--print(#targets)
	for _,target in pairs(targets) do
		if target:HasModifier("modifier_plants") then
			start_dance = true
			break
		end
	end
	if start_dance and caster:IsAlive() then
		--print("start dancing")
		local top_modifier = "modifier_line_1"
		local bot_modifier = "modifier_line_5"
		if GetMapName() == "1x1" then 
			top_modifier = "modifier_line_1"
			bot_modifier = "modifier_line_5"
		elseif GetMapName() == "2x2" then 
			top_modifier = "modifier_line_1"
			bot_modifier = "modifier_line_8"
		end


		local CasterVector = caster:GetForwardVector()
		
			--zombie_dancer:SetForwardVector(Vector(0,1,0))
		if caster:HasModifier(top_modifier) then -- если зомби сверху, то спавним на нижней линии двоих паралельно верхней
			--print("has mod1")
			local zombie_dancer1 = CreateUnitByName("npc_zombie_6_2_summon", caster:GetAbsOrigin() + CasterVector * 300, true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer1:SetForwardVector(CasterVector) -- спереди
			self.dancer1 = zombie_dancer1
			local zombie_dancer2 = CreateUnitByName("npc_zombie_6_2_summon", caster:GetAbsOrigin() + CasterVector * (-200), true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer2:SetForwardVector(CasterVector) -- сзади
			self.dancer2 = zombie_dancer2

			local vec = Vector(0,-1,0)

			local zombie_dancer3 = CreateUnitByName("npc_zombie_6_2_summon", zombie_dancer1:GetAbsOrigin() + vec * 200, true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer3:SetForwardVector(CasterVector) -- снизу спереди
			self.dancer3 = zombie_dancer3

			local zombie_dancer4 = CreateUnitByName("npc_zombie_6_2_summon", zombie_dancer2:GetAbsOrigin() + vec * 200, true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer4:SetForwardVector(CasterVector) -- снизу сзади
			self.dancer4 = zombie_dancer4

		elseif caster:HasModifier(bot_modifier) then -- если зомби снизу, то спавним на верхней линии двоих паралельно нижней

			--print("has mod2")
			local zombie_dancer1 = CreateUnitByName("npc_zombie_6_2_summon", caster:GetAbsOrigin() + CasterVector * 300, true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer1:SetForwardVector(CasterVector) -- спереди
			self.dancer1 = zombie_dancer1

			local zombie_dancer2 = CreateUnitByName("npc_zombie_6_2_summon", caster:GetAbsOrigin() + CasterVector * (-200), true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer2:SetForwardVector(CasterVector) -- сзади
			self.dancer2 = zombie_dancer2

			local vec = Vector(0,1,0)

			local zombie_dancer3 = CreateUnitByName("npc_zombie_6_2_summon", zombie_dancer1:GetAbsOrigin() + vec * 200, true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer3:SetForwardVector(CasterVector) -- сверху спереди
			self.dancer3 = zombie_dancer3

			local zombie_dancer4 = CreateUnitByName("npc_zombie_6_2_summon", zombie_dancer2:GetAbsOrigin() + vec * 200, true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer4:SetForwardVector(CasterVector) -- сверху сзади
			self.dancer4 = zombie_dancer4
		else 
			--print("has no mod1 and 2")
			local vec1 = Vector(0,1,0)
			local z1obs = caster:GetAbsOrigin() + vec1 * 200

			local zombie_dancer1 = CreateUnitByName("npc_zombie_6_2_summon", z1obs, true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer1:SetForwardVector(CasterVector) -- вверху
			FindClearSpaceForUnit(zombie_dancer1, zombie_dancer1:GetAbsOrigin() + zombie_dancer1:GetForwardVector() * 50, false)
			self.dancer1 = zombie_dancer1

			local vec2 = Vector(0,-1,0)
			local z2obs = caster:GetAbsOrigin() + vec2 * 200

			local zombie_dancer2 = CreateUnitByName("npc_zombie_6_2_summon", z2obs, true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer2:SetForwardVector(CasterVector) --внизу
			FindClearSpaceForUnit(zombie_dancer2, zombie_dancer2:GetAbsOrigin() + zombie_dancer2:GetForwardVector() * 50, false)
			self.dancer2 = zombie_dancer2

			local zombie_dancer3 = CreateUnitByName("npc_zombie_6_2_summon", caster:GetAbsOrigin() + CasterVector * 300, true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer3:SetForwardVector(CasterVector) -- спереди 
			self.dancer3 = zombie_dancer3

			local zombie_dancer4 = CreateUnitByName("npc_zombie_6_2_summon", caster:GetAbsOrigin() + CasterVector * (-200), true, nil, nil, DOTA_TEAM_BADGUYS)
			zombie_dancer4:SetForwardVector(CasterVector)	-- сзади
			self.dancer4 = zombie_dancer4

		end
			
			self.dancer1:AddNewModifier(caster, self:GetAbility(), "modifier_zombie_dancing", {duration = 3})
			self.dancer1:AddNewModifier(caster, nil, "modifier_zombie", {})
			self.dancer1:AddNewModifier(caster, nil, "z_modifier_6_attacks", {})
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_glasses.vmdl"}):FollowEntity(self.dancer1, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_wig.vmdl"}):FollowEntity(self.dancer1, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_armor.vmdl"}):FollowEntity(self.dancer1, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_arms.vmdl"}):FollowEntity(self.dancer1, true)
			self.dancer2:AddNewModifier(caster, self:GetAbility(), "modifier_zombie_dancing", {duration = 3})
			self.dancer2:AddNewModifier(caster, nil, "modifier_zombie", {})
			self.dancer2:AddNewModifier(caster, nil, "z_modifier_6_attacks", {})
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_glasses.vmdl"}):FollowEntity(self.dancer2, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_wig.vmdl"}):FollowEntity(self.dancer2, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_armor.vmdl"}):FollowEntity(self.dancer2, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_arms.vmdl"}):FollowEntity(self.dancer2, true)
			self.dancer3:AddNewModifier(caster, self:GetAbility(), "modifier_zombie_dancing", {duration = 3})
			self.dancer3:AddNewModifier(caster, nil, "modifier_zombie", {})
			self.dancer3:AddNewModifier(caster, nil, "z_modifier_6_attacks", {})
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_glasses.vmdl"}):FollowEntity(self.dancer3, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_wig.vmdl"}):FollowEntity(self.dancer3, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_armor.vmdl"}):FollowEntity(self.dancer3, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_arms.vmdl"}):FollowEntity(self.dancer3, true)
			self.dancer4:AddNewModifier(caster, self:GetAbility(), "modifier_zombie_dancing", {duration = 3})
			self.dancer4:AddNewModifier(caster, nil, "modifier_zombie", {})
			self.dancer4:AddNewModifier(caster, nil, "z_modifier_6_attacks", {})
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_glasses.vmdl"}):FollowEntity(self.dancer4, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_wig.vmdl"}):FollowEntity(self.dancer4, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_armor.vmdl"}):FollowEntity(self.dancer4, true)
			SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/dancer_arms.vmdl"}):FollowEntity(self.dancer4, true)

		caster:AddNewModifier(caster, self:GetAbility(), "modifier_zombie_dancing", {duration = 3})
		self:GetAbility():UseResources(false, false, false, true)
	end

	
end
end
end

modifier_zombie_dancing = class({})
function modifier_zombie_dancing:IsHidden() return true end
function modifier_zombie_dancing:OnCreated()
	local parent = self:GetParent()
	if parent:GetUnitName()~="npc_zombie_6_2" then
		local particle = "particles/disco_ball_channel.vpcf"
		self.fx = ParticleManager:CreateParticle(particle, PATTACH_ABSORIGIN_FOLLOW, parent)
		
		ParticleManager:SetParticleControlEnt( self.fx, 0, parent, PATTACH_OVERHEAD_FOLLOW, nil, parent:GetAbsOrigin(), true)
		self:AddParticle(self.fx, false, false, -1, false, true)

	end
end
function modifier_zombie_dancing:DeclareFunctions()
	return {
		MODIFIER_PROPERTY_OVERRIDE_ANIMATION
	}
end
function modifier_zombie_dancing:GetOverrideAnimation()
	return ACT_DOTA_TAUNT
end
--[[function z_modifier_5_2_attacks:GetOverrideAnimation()
	return ACT_DOTA_TAUNT
end
]]


zombie_spawn_6_3 = class({})

function zombie_spawn_6_3:GetIntrinsicModifierName()
	return "modifier_spawn_6_3_checker"
end

function zombie_spawn_6_3:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_6_3"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_attacker_5 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_attacker_5:SetInitialGoalEntity( waypointlocation )
	zombie_attacker_5:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_attacker_5:SetIdleAcquire(false)
	zombie_attacker_5:FindAbilityByName("z_6_3_attack"):SetLevel(1)
end

modifier_spawn_6_3_checker = class({})

function modifier_spawn_6_3_checker:IsHidden() return true end
function modifier_spawn_6_3_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_6_3_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end

-------------------------------- ATTACKER 5 SPELL ----------------------
z_6_3_attack = class({}) -- pharaon

function z_6_3_attack:GetIntrinsicModifierName()
	return "z_modifier_6_3_attacks"
end

z_modifier_6_3_attacks = class({})

function z_modifier_6_3_attacks:IsHidden() return false end
function z_modifier_6_3_attacks:IsBuff() return true end

function z_modifier_6_3_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED
	}
end
function z_modifier_6_3_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end

function z_modifier_6_3_attacks:OnCreated()
	self:StartIntervalThink(0.2)
end
function z_modifier_6_3_attacks:OnIntervalThink()
if IsServer() then
if self:GetAbility():IsCooldownReady() then
	local has_done = false
	local caster = self:GetParent()
	local targets = FindUnitsInRadius(caster:GetTeamNumber(), caster:GetAbsOrigin(), nil, 200, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_ALL, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES, FIND_CLOSEST, false)
		local lines = pvzGameMode:GetLines()

		for _,target in pairs(targets) do
			if not has_done then
				for i = 1, lines do
					if caster:HasModifier("modifier_line_"..i) and target:HasModifier("modifier_line_"..i) then
						if target:HasModifier("modifier_plants") then
							--print("found plants")						
							local ph_tomb = CreateUnitByName("npc_pharaon_tomb", caster:GetAbsOrigin() + caster:GetForwardVector()*(-25), true, nil, nil, DOTA_TEAM_BADGUYS)
							ph_tomb:SetForwardVector(caster:GetForwardVector())
							ph_tomb:FindAbilityByName("pharaon_spawn"):SetLevel(1)
							caster:StartGesture(ACT_DOTA_CAST_ABILITY_3)
							has_done = true
							self:GetAbility():UseResources(false, false, false, true)
						end
					end
				end
			end  
		end
end
end
end
pharaon_spawn = class({})
function pharaon_spawn:GetIntrinsicModifierName()
	return "modifier_pharaon_spawn"
end
modifier_pharaon_spawn = class({})
function modifier_pharaon_spawn:IsHidden() return true end
function modifier_pharaon_spawn:OnCreated()
if IsServer() then
	self:StartIntervalThink(5)
	Timers:CreateTimer(0.2, function( )
		self:OnIntervalThink()
	end)
end
end
function modifier_pharaon_spawn:CheckState()
	return {
		[MODIFIER_STATE_NO_UNIT_COLLISION] = true
	}
end
function modifier_pharaon_spawn:OnIntervalThink()
if not IsServer() then return end
local caster = self:GetParent()
if caster:IsAlive() then
	local ph_zombie = CreateUnitByName("npc_pharaon_zombie", caster:GetAbsOrigin()+caster:GetForwardVector()*15, true, nil, nil, DOTA_TEAM_BADGUYS)
	ph_zombie:SetForwardVector(caster:GetForwardVector())
	ph_zombie:AddNewModifier(self:GetParent(), nil, "z_modifier_6_attacks", {})
	ph_zombie:AddNewModifier(self:GetParent(), nil, "modifier_zombie", {})
	self:GetAbility():UseResources(false, false, false, true)
end

end


zombie_spawn_6_1 = class({})

function zombie_spawn_6_1:GetIntrinsicModifierName()
	return "modifier_spawn_6_checker"
end

function zombie_spawn_6_1:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_cannon"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""
	

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				--WaypointName = "cannon"..i
				SpawnName = "vawe"..i.."spawn"
			end
		end
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local cannon = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, caster:GetOwner(), DOTA_TEAM_BADGUYS)
	
	if caster:GetOwner()==nil then
		cannon:FindAbilityByName("cannon_3"):ToggleAbility()
	else
		cannon:FindAbilityByName("cannon_1"):ToggleAbility()
		cannon:SetControllableByPlayer(caster:GetOwner():GetPlayerOwnerID(), false )
	end

	
	cannon:SetForwardVector(cannon:GetForwardVector() * -1)
	
	EmitSoundOn("SoundCannonRun", cannon)
	

	cannon:AddNewModifier(caster, self, "modifier_zombie", {})

	--cannon:SetInitialGoalEntity( waypointlocation )


	cannon:AddNewModifier(caster, self, "modifier_cannon", {})
	--cannon:StartGesture(ACT_DOTA_IDLE)
	--zombie_attacker_5:FindAbilityByName("z_6_attack"):SetLevel(1)
end

modifier_cannon = class({})
function modifier_cannon:IsHidden() return true end
function modifier_cannon:CheckState()
	return {
		[MODIFIER_STATE_NO_HEALTH_BAR] = true,
		[MODIFIER_STATE_ATTACK_IMMUNE] = false,
		[MODIFIER_STATE_LOW_ATTACK_PRIORITY] = true,
		[MODIFIER_STATE_INVULNERABLE] = false,
		[MODIFIER_STATE_NO_UNIT_COLLISION ] = true
	}
	
end
function modifier_cannon:DeclareFunctions()
	--return MODIFIER_PROPERTY_OVERRIDE_ANIMATION
end
--function modifier_cannon:GetOverrideAnimation() return ACT_DOTA_RUN end
function ApplyCannonModifier(event)
	--print("cannon arived")
	if event.activator:GetUnitName()=="npc_cannon" then
		event.activator:RemoveModifierByName("modifier_zombie")
		event.activator:Stop()
		event.activator:AddNewModifier(event.activator, event, "modifier_cannon_arrived", {})
		event.activator:AddNewModifier(event.activator, event, "modifier_disable_turning", {})
		if not event.activator:FindAbilityByName("cannon_1"):GetToggleState() then
			event.activator:FindAbilityByName("cannon_1"):ToggleAbility()
		end
	end
end

modifier_cannon_arrived = class({})
function modifier_cannon_arrived:IsHidden() return true end
function modifier_cannon_arrived:CheckState()
	return {
		[MODIFIER_STATE_NO_HEALTH_BAR] = true,
		[MODIFIER_STATE_ROOTED] = true,
		[MODIFIER_STATE_ATTACK_IMMUNE] = true,
		[MODIFIER_STATE_LOW_ATTACK_PRIORITY] = true,
		[MODIFIER_STATE_NO_UNIT_COLLISION ] = true
	}
	
end
function modifier_cannon_arrived:RemoveOnDeath() return true end
function modifier_cannon_arrived:OnDeath()
	self:GetParent():RemoveSelf()
end
function modifier_cannon_arrived:OnCreated()
if IsServer() then
	local cannon = self:GetParent()
	local allHeroes = HeroList:GetAllHeroes()
	for k, v in pairs( allHeroes ) do
		if v:GetUnitName()=="npc_dota_hero_undying" then
			if v == self:GetParent():GetOwner() then
				--if v:HasModifier("modifier_main_undying") then print("owner main undying") end
				--if v:HasModifier("modifier_second_undying") then print("owner second undying") end				
				cannon:SetControllableByPlayer(v:GetPlayerOwnerID(), true )
			end
		end
	end
	cannon:StartGesture(ACT_DOTA_ATTACK)
	StopSoundOn("SoundCannonRun", cannon)
	EmitSoundOn("SoundCannonLoading", cannon)
	self:StartIntervalThink(0.2)
	self:OnIntervalThink()
	Timers:CreateTimer(1.9, function( )
		StopSoundOn("SoundCannonLoading", cannon)
	end)
	Timers:CreateTimer(3.6667, function()
		StopSoundOn("SoundCannonLoading", cannon)
		EmitSoundOn("SoundCannonShoot", cannon)
		self.particle_vzriv = "particles/techies_remote_mines_detonate.vpcf"
		self.particle_vzriv_fx = ParticleManager:CreateParticle(self.particle_vzriv, PATTACH_ABSORIGIN_FOLLOW, self:GetParent())
		ParticleManager:SetParticleControl(self.particle_vzriv_fx, 0,self:GetParent():GetAbsOrigin())
		ParticleManager:SetParticleControl(self.particle_vzriv_fx, 1, self:GetParent():GetAbsOrigin())

		self.cannon_zombie = CreateUnitByName("npc_zombie_6", cannon:GetAbsOrigin() + cannon:GetForwardVector()*100, true, nil, nil, DOTA_TEAM_BADGUYS)
		self.cannon_zombie:SetForwardVector(cannon:GetForwardVector())
		self.cannon_zombie:AddNewModifier(self.cannon_zombie, nil, "modifier_zombie", {})
		self.cannon_zombie:AddNewModifier(self.cannon_zombie, nil, "z_modifier_6_attacks", {})
		SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/undying_helmet.vmdl"}):FollowEntity(self.cannon_zombie, true)
		SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/undying_arms.vmdl"}):FollowEntity(self.cannon_zombie, true)
		SpawnEntityFromTableSynchronous("prop_dynamic", {model = "models/zombies/undying_armor.vmdl"}):FollowEntity(self.cannon_zombie, true)
		local rand = RandomInt(1,100)
		if rand <= 70 then EmitSoundOn("SoundCannonZombieScream", self.cannon_zombie) end
		if rand >=71 and rand <= 85 then EmitSoundOn("SoundCannonZombieScream2", self.cannon_zombie) end
		if rand >= 86 and rand <= 100 then EmitSoundOn("SoundCannonZombieScream3", self.cannon_zombie)  end

		
		local ability_1 = self.cannon_zombie:FindAbilityByName("cannon_attack1")
		local ability_2 = self.cannon_zombie:FindAbilityByName("cannon_attack2")
		local ability_3 = self.cannon_zombie:FindAbilityByName("cannon_attack3")

		if cannon:HasModifier("modifier_cannon_4") then
			self.zombie_fly_ability = ability_2
			self.cannon_zombie:RemoveAbility("cannon_attack1")
			self.cannon_zombie:RemoveAbility("cannon_attack3")
			self.cannon_zombie:AddNewModifier(self.cannon_zombie, self.zombie_fly_ability, "modifier_mirana_leap", {})

		elseif cannon:HasModifier("modifier_cannon_5") then
			self.zombie_fly_ability = ability_3
			local zombik = self.cannon_zombie
			zombik:RemoveAbility("cannon_attack1")
			zombik:RemoveAbility("cannon_attack2")
			self.cannon_zombie:AddNewModifier(self.cannon_zombie, self.zombie_fly_ability, "modifier_mirana_leap", {})
		else 	-- modifier_cannon_3	
			self.zombie_fly_ability = ability_1
			self.cannon_zombie:RemoveAbility("cannon_attack2")
			self.cannon_zombie:RemoveAbility("cannon_attack3")

			self.cannon_zombie:AddNewModifier(self.cannon_zombie, self.zombie_fly_ability, "modifier_mirana_leap", {})
		end

		self.cannon_zombie:AddNewModifier(self.cannon_zombie, nil, "modifier_disable_turning", {duration = 2.2})
		--cannon_zombie:AddNewModifier(cannon_zombie, nil, "modifier_zombie_autoattack", {duration = 1.5})
		self.cannon_zombie:AddNewModifier(self.cannon_zombie, nil, "modifier_flying_zombie", {duration = 2.2})
	end)
			Timers:CreateTimer(6.9, function()
			--self.cannon_zombie:Stop()
			--self.cannon_zombie:AddNewModifier(self.cannon_zombie, nil, "modifier_stunned", {duration = 0.2})
			cannon:RemoveSelf()
		end)
end
end


function modifier_cannon_arrived:OnIntervalThink()
if IsServer() then
	local caster = self:GetParent()

	local ability1 = caster:FindAbilityByName("cannon_1")
	local ability2 = caster:FindAbilityByName("cannon_2")
	local ability3 = caster:FindAbilityByName("cannon_3")

	local direction = caster:GetForwardVector()

	local startPos5 = caster:GetAbsOrigin() + direction * 2135
	local endPos5 = caster:GetAbsOrigin() + direction * 2189

	local startPos4 = caster:GetAbsOrigin() + direction * 1908
	local endPos4 = caster:GetAbsOrigin() + direction * 2035

	local startPos3 = caster:GetAbsOrigin() + direction * 1690
	local endPos3 = caster:GetAbsOrigin() + direction * 1833
	-- 1450 1 сell
	-- 1654 2 cell
	-- 1858 3 cell
	-- 2060 4 cell
	-- 2264 5 cell
	-- 2468 6 cell
	-----------------------------------------------------------------------------------------------------------------
	local units5 = FindUnitsInLine(caster:GetTeam(), startPos5, endPos5, nil, 75, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_BASIC, 0)
	if #units5==0 then
		ability3:SetActivated(true)
		--print("cannon 5 not")
	else

		if ability3:GetToggleState() then -- если 3 скил вкл
			--ability3:ToggleAbility() -- то выкл его
			if ability2:IsActivated() and not ability2:GetToggleState() then -- если 2 абилка активна и выключена мы её вкл
				--print("3 second active and toggled off")
				ability2:ToggleAbility()
			elseif ability1:IsActivated() and not ability1:GetToggleState() then -- если 1 абилка активна и выключена мы её вкл
				--print("3 first active and toggled off")
				ability1:ToggleAbility()
			end
			caster:RemoveModifierByName("modifier_cannon_5") -- убираем возможность стрелять
		end
		ability3:SetActivated(false)
		--print("in 5 "..#units5)
	end
	-----------------------------------------------------------------------------------------------------------------
	local units4 = FindUnitsInLine(caster:GetTeam(), startPos4, endPos4, nil, 75, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_BASIC, 0)
	if #units4==0 then
		ability2:SetActivated(true)
		--print("cannon 4 not")
	else
		if ability2:GetToggleState() then -- если 2 скил вкл
			--ability2:ToggleAbility() -- то выкл его
			if ability3:IsActivated() and not ability3:GetToggleState() then -- если 3 абилка активна и выключена мы еёё вкл
				--print("2 third active and toggled off")
				ability3:ToggleAbility()
			elseif ability1:IsActivated() and not ability1:GetToggleState() then -- если 1 абилка активна и выключена мы еёё вкл
				--print("2 first active and toggled off")
				ability1:ToggleAbility()
			end
			caster:RemoveModifierByName("modifier_cannon_4") -- убираем возможность стрелять
		end
		ability2:SetActivated(false)
		--print("in 4 "..#units4)
	end
	-----------------------------------------------------------------------------------------------------------------
	local units3 = FindUnitsInLine(caster:GetTeam(), startPos3, endPos3, nil, 75, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_BASIC, 0)
	if #units3==0 then
		ability1:SetActivated(true)
		--print("cannon 3 not")
	else
		if ability1:GetToggleState() then -- если 3 скил вкл
			--ability1:ToggleAbility() -- то выкл его
			if ability2:IsActivated() and not ability2:GetToggleState() then -- если 2 абилка активна и выключена мы еёё вкл
				--print("1 first active and toggled off")
				ability2:ToggleAbility()
			elseif ability3:IsActivated() and not ability3:GetToggleState() then -- если 3 абилка активна и выключена мы еёё вкл
				--print("1 second active and toggled off")
				ability3:ToggleAbility()
			end
			caster:RemoveModifierByName("modifier_cannon_3") -- убираем возможность стрелять
		end
		ability1:SetActivated(false)
		--print("in 3 "..#units3)
	end

	-----------------------------------------------------------------------------------------------------------------

	if not caster:HasModifier("modifier_cannon_3") and not caster:HasModifier("modifier_cannon_4") and not caster:HasModifier("modifier_cannon_5") then
		caster:AddNewModifier(self:GetCaster(), self, "modifier_cannon_3", {})
	end
	
	if not ability1:IsActivated() and not ability2:IsActivated() and not ability3:IsActivated() then
		ability1:SetActivated(true) -- если везде враги то оставляем первую абилку
		if not ability1:GetToggleState() then -- если 1 скил выкл
			ability1:ToggleAbility() -- то вкл его
			--print("set 1 spell active")
		end
		if ability2:GetToggleState() and not ability2:IsActivated() then -- если 2 скил вкл и не активный
			ability2:SetActivated(true)
			ability2:ToggleAbility() -- то выкл его
			ability2:SetActivated(false)
			--print("set 2 spell active")
		end
		if ability3:GetToggleState() and not ability3:IsActivated() then -- если 2 скил вкл и не активный
			ability3:SetActivated(true)
			ability3:ToggleAbility() -- то выкл его
			ability3:SetActivated(false)
			--print("set 3 spell active")
		end
	end
	

end
end


cannon_1 = class({})
cannon_2 = class({})
cannon_3 = class({})

function cannon_1:OnToggle()
	local ability2 = self:GetCaster():FindAbilityByName("cannon_2")
	local ability3 = self:GetCaster():FindAbilityByName("cannon_3")
	if self:GetToggleState() then
		self:GetCaster():AddNewModifier(self:GetCaster(), self, "modifier_cannon_3", {})
		self:GetCaster():RemoveModifierByName("modifier_cannon_4")
		self:GetCaster():RemoveModifierByName("modifier_cannon_5")
		if ability2:GetToggleState() then
			ability2:ToggleAbility()
		end
		if ability3:GetToggleState() then
			ability3:ToggleAbility()
		end
	elseif not ability2:GetToggleState() and not ability3:GetToggleState() then
		self:ToggleAbility()
	-- нельзя выключить
	end
	if not self:IsActivated() and self:GetToggleState() then -- если абилка неактивна и включена
		if ability2:IsActivated() and not ability2:GetToggleState() then ability2:ToggleAbility() -- если другая абилка активна и выключена мы еёё вкл
		elseif ability3:IsActivated() and not ability3:GetToggleState() then ability3:ToggleAbility() end -- если третья абилка активна и выключена мы еёё вкл
	end	

	--print("spell 1")
end

function cannon_2:OnToggle()
	local ability1 = self:GetCaster():FindAbilityByName("cannon_1")
	local ability3 = self:GetCaster():FindAbilityByName("cannon_3")
	if self:GetToggleState() then
		self:GetCaster():AddNewModifier(self:GetCaster(), self, "modifier_cannon_4", {})
		self:GetCaster():RemoveModifierByName("modifier_cannon_3")
		self:GetCaster():RemoveModifierByName("modifier_cannon_5")
		if ability1:GetToggleState() then
			ability1:ToggleAbility()
		end
		if ability3:GetToggleState() then
			ability3:ToggleAbility()
		end
	elseif not ability1:GetToggleState() and not ability3:GetToggleState() then
		self:ToggleAbility()
	-- нельзя выключить
	end
	if not self:IsActivated() and self:GetToggleState() then -- если абилка неактивна и включена
		if ability1:IsActivated() and not ability1:GetToggleState() then ability1:ToggleAbility() -- если другая абилка активна и выключена мы еёё вкл
		elseif ability3:IsActivated() and not ability3:GetToggleState() then ability3:ToggleAbility() end -- если третья абилка активна и выключена мы еёё вкл
	end	
	--print("spell 2")
end
function cannon_3:OnToggle()
	local ability1 = self:GetCaster():FindAbilityByName("cannon_1")
	local ability2 = self:GetCaster():FindAbilityByName("cannon_2")
	if self:GetToggleState() then
		self:GetCaster():AddNewModifier(self:GetCaster(), self, "modifier_cannon_5", {})
		self:GetCaster():RemoveModifierByName("modifier_cannon_3")
		self:GetCaster():RemoveModifierByName("modifier_cannon_4")
		if ability1:GetToggleState() then
			ability1:ToggleAbility()
		end
		if ability2:GetToggleState() then
			ability2:ToggleAbility()
		end
	elseif not ability1:GetToggleState() and not ability2:GetToggleState() then
		self:ToggleAbility()
	end
	if not self:IsActivated() and self:GetToggleState() then -- если абилка неактивна и включена
		if ability1:IsActivated() and not ability1:GetToggleState() then ability1:ToggleAbility() -- если другая абилка активна и выключена мы еёё вкл
		elseif ability3:IsActivated() and not ability3:GetToggleState() then ability2:ToggleAbility() end -- если третья абилка активна и выключена мы еёё вкл
	end	
	--print("spell 3")
end

modifier_cannon_3 = class({})
modifier_cannon_4 = class({})
modifier_cannon_5 = class({})

modifier_spawn_6_checker = class({})

function modifier_spawn_6_checker:IsHidden() return true end
function modifier_spawn_6_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_6_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end




-------------------------------- ATTACKER 6 SPELL ----------------------
cannon_attack1 = class({})


z_modifier_6_attacks = class({})

function z_modifier_6_attacks:IsHidden() return true end
function z_modifier_6_attacks:IsBuff() return true end
function z_modifier_6_attacks:OnCreated()
	self:StartIntervalThink(0.2)
end
function z_modifier_6_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED
	}
end
function z_modifier_6_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Undying_Zombie.Attack", event.attacker)
	end
end


-------------------------------- ATTACKER 6 SPELL ----------------------
cannon_attack2 = class({})


-------------------------------- ATTACKER 6 SPELL ----------------------
cannon_attack3 = class({})


modifier_flying_zombie = class({})

function modifier_flying_zombie:IsHidden() return true end

function modifier_flying_zombie:CheckState() 
	return {
		[MODIFIER_STATE_NO_HEALTH_BAR] = true,
		[MODIFIER_STATE_ATTACK_IMMUNE] = true,
		[MODIFIER_STATE_LOW_ATTACK_PRIORITY] = true,
		[MODIFIER_STATE_NO_UNIT_COLLISION ] = true,
		[MODIFIER_STATE_COMMAND_RESTRICTED] = true,
		[MODIFIER_STATE_STUNNED] = true
	}


end

function modifier_flying_zombie:DeclareFunctions()
	local funcs = {
		MODIFIER_PROPERTY_OVERRIDE_ANIMATION
	}
	return funcs
end

function modifier_flying_zombie:GetOverrideAnimation() return ACT_DOTA_FLAIL end

function modifier_flying_zombie:OnDestroy()
if IsServer() then
	if self:GetParent():HasAbility("cannon_attack1") then self:GetParent():RemoveAbility("cannon_attack1") end
end
end
--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================
--				--									==============
--				--									            ==
--				--									          ==
--				--										==========
--				--										   ==   
--				--										 ==	    
--				--									   ==
--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================


zombie_spawn_7_1 = class({})

function zombie_spawn_7_1:GetIntrinsicModifierName()
	return "modifier_spawn_7_checker"
end

function zombie_spawn_7_1:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_7"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""
	

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end  
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_7 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_7:SetInitialGoalEntity( waypointlocation )
	zombie_7:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_7:SetIdleAcquire(false)
	zombie_7:FindAbilityByName("z_7_attack"):SetLevel(1)
end

modifier_spawn_7_checker = class({})

function modifier_spawn_7_checker:IsHidden() return true end
function modifier_spawn_7_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_7_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end



-------------------------------- ATTACKER 7 SPELL ----------------------

z_7_attack = class({})

function z_7_attack:GetIntrinsicModifierName()
	return "z_modifier_7_attacks"
end

z_modifier_7_attacks = class({})

function z_modifier_7_attacks:IsHidden() return true end
function z_modifier_7_attacks:IsBuff() return true end

function z_modifier_7_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE_MIN,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE,
		MODIFIER_PROPERTY_IGNORE_MOVESPEED_LIMIT,
		MODIFIER_PROPERTY_MOVESPEED_LIMIT
	}
end
function z_modifier_7_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Hero_Treant.Attack", event.attacker)
	end
end

function z_modifier_7_attacks:GetModifierIgnoreMovespeedLimit() return 1 end
function z_modifier_7_attacks:GetModifierMoveSpeed_Absolute() return 200 end
function z_modifier_7_attacks:GetModifierMoveSpeed_AbsoluteMin() return 200 end
function z_modifier_7_attacks:GetModifierMoveSpeed_Limit() return 200 end


function z_modifier_7_attacks:IsAura()
    return true
end
function z_modifier_7_attacks:GetModifierAura()
    return "modifier_gargantua_flower_aura"
end
function z_modifier_7_attacks:GetAuraRadius()
    return 10000
end
function z_modifier_7_attacks:GetAuraSearchTeam()    
    return DOTA_UNIT_TARGET_TEAM_FRIENDLY
end
function z_modifier_7_attacks:GetAuraDuration()    
    return 1.0
end
function z_modifier_7_attacks:GetAuraSearchType()    
    return DOTA_UNIT_TARGET_BASIC
end
function z_modifier_7_attacks:GetAuraSearchFlags()
    return DOTA_UNIT_TARGET_FLAG_NONE
end
modifier_gargantua_flower_aura = class({
    IsHidden                = function(self) return false end,
    IsPurgable              = function(self) return false end,
    IsPurgeException        = function(self) return false end,
    IsBuff                  = function(self) return true end,
    RemoveOnDeath           = function(self) return true end,   
})


--------------------------------------------------------------------------------


function modifier_gargantua_flower_aura:GetTexture() return "zombies/ability7_1" end

function modifier_gargantua_flower_aura:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_PROPERTY_HEALTH_REGEN_CONSTANT 
	}
end
function modifier_gargantua_flower_aura:GetModifierConstantHealthRegen(event)
	return 5
end
function modifier_gargantua_flower_aura:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		event.attacker:Heal(5, self:GetAbility())
		print("healing aura")
		local particle_heal = "particles/econ/items/juggernaut/jugg_fall20_immortal/jugg_fall20_immortal_healing_ward_expire.vpcf"
		local particle_heal_fx = ParticleManager:CreateParticle(particle_heal, PATTACH_ABSORIGIN_FOLLOW, event.attacker)
		ParticleManager:SetParticleControl(particle_heal_fx, 0, event.attacker:GetAbsOrigin())
	end
end

--==================================================================================================================================================
--==================================================================================================================================================
--==================================================================================================================================================


zombie_spawn_7_2 = class({})

function zombie_spawn_7_2:GetIntrinsicModifierName()
	return "modifier_spawn_7_2_checker"
end

function zombie_spawn_7_2:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_7_2"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""


	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end 
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_7 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_7:SetInitialGoalEntity( waypointlocation )
	zombie_7:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_7:SetIdleAcquire(false)
	zombie_7:FindAbilityByName("z_7_2_attack"):SetLevel(1)
end

modifier_spawn_7_2_checker = class({})

function modifier_spawn_7_2_checker:IsHidden() return true end
function modifier_spawn_7_2_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_7_2_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end



-------------------------------- ATTACKER 7 SPELL ----------------------

z_7_2_attack = class({})

function z_7_2_attack:GetIntrinsicModifierName()
	return "z_modifier_7_2_attacks"
end

z_modifier_7_2_attacks = class({})

function z_modifier_7_2_attacks:IsHidden() return true end
function z_modifier_7_2_attacks:IsBuff() return true end

function z_modifier_7_2_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_EVENT_ON_ATTACK_START
	}
end
function z_modifier_7_2_attacks:OnAttackStart(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Hero_Pudge.PreAttack", event.attacker)
	end
end
function z_modifier_7_2_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Hero_Pudge.Attack", event.attacker)
	end
end

function z_modifier_7_2_attacks:OnCreated()
	self:StartIntervalThink(0.5)
end 

function z_modifier_7_2_attacks:OnIntervalThink()
if IsServer() then
if self:GetAbility():IsCooldownReady() then
	local has_done = false
	local caster = self:GetParent()
	local targets = FindUnitsInRadius(caster:GetTeamNumber(), caster:GetAbsOrigin(), nil, 816, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_ALL, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES, FIND_FARTHEST, false)
		local lines = pvzGameMode:GetLines()

		for _,target in pairs(targets) do
		if not has_done then
			for i = 1, lines do
				if caster:HasModifier("modifier_line_"..i) and target:HasModifier("modifier_line_"..i) then -- если рядом трава с нужной линии

					if target:HasModifier("modifier_plants") then 
						local direction = caster:GetForwardVector()
						--print(direction.x.." "..direction.y.." "..direction.z)
						--origin = caster:GetAbsOrigin() + direction * 150
						local pug = CreateUnitByName("npc_summon_7_2", caster:GetAbsOrigin() + Vector(-1, 0, 0) * 150, true, nil, nil, DOTA_TEAM_BADGUYS)
						caster:StartGesture(ACT_DOTA_CAST_ABILITY_ROT)
						EmitSoundOn("SoundDog", pug)
						pug:SetForwardVector(direction)
						pug:AddNewModifier(pug, nil, "modifier_zombie_dog", {duration = 5})
						pug:AddNewModifier(pug, nil, "z_modifier_smelly", {})
						self:GetAbility():UseResources(false, false, false, true) 
						has_done = true
				end
			end
		end
		end  
	end

end
end
end
summon_7 = class({})
modifier_zombie_dog = class({})
function modifier_zombie_dog:OnCreated()
if IsServer() then
	self:StartIntervalThink(0.5)
end
end
function modifier_zombie_dog:OnIntervalThink()
if IsServer() then	
	local parent = self:GetParent()
	local PointOrigin = parent:GetAbsOrigin() + parent:GetForwardVector() * 600
	
	local order_zombie =
	{
		UnitIndex = parent:entindex(),
		OrderType = DOTA_UNIT_ORDER_MOVE_TO_POSITION,
		Position = PointOrigin			
	}
	--print("move to position")
	--zombie:RemoveModifierByName("modifier_zombie_autoattack")
	ExecuteOrderFromTable(order_zombie)
end
end
function modifier_zombie_dog:OnDestroy()
if not IsServer() then return end
	if self:GetParent():IsAlive() then
		self:GetParent():AddNewModifier(self:GetParent(), nil, "modifier_zombie_dog_comeback", {})
		self:GetParent():FindModifierByName("modifier_zombie_dog_comeback"):OnIntervalThink()
	end
end


modifier_zombie_dog_comeback = class({})
function modifier_zombie_dog_comeback:IsHidden() return true end
function modifier_zombie_dog_comeback:OnCreated()
if IsServer() then
	self:StartIntervalThink(3)

end
end
function modifier_zombie_dog_comeback:CheckState()
	return {
		[MODIFIER_STATE_NO_UNIT_COLLISION ] = true
	}
end
function modifier_zombie_dog_comeback:OnIntervalThink()
if IsServer() then
	local parent = self:GetParent()

	local PointOrigin = parent:GetAbsOrigin() + parent:GetForwardVector() * (-1200)

	
	local order_zombie =
	{
		UnitIndex = parent:entindex(),
		OrderType = DOTA_UNIT_ORDER_MOVE_TO_POSITION,
		Position = PointOrigin			
	}
	--print("move to position")
	--zombie:RemoveModifierByName("modifier_zombie_autoattack")
	ExecuteOrderFromTable(order_zombie)
end
end


--==============================================================================================


zombie_spawn_7_3 = class({})

function zombie_spawn_7_3:GetIntrinsicModifierName()
	return "modifier_spawn_7_3_checker"
end

function zombie_spawn_7_3:OnSpellStart()
	local caster = self:GetCaster()
	local unit_name = "npc_zombie_7_3"
	local lines = pvzGameMode:GetLines()
	local WaypointName = ""
	local SpawnName = ""
	

	if caster:HasModifier("modifier_lines") then
		for i=1, lines do
			if caster:HasModifier("modifier_line_"..i) then
				WaypointName = "vawe"..i.."1"
				SpawnName = "vawe"..i.."spawn"
			end
		end 
	end
	local SpawnLocation = Entities:FindByName( nil, SpawnName )
	local waypointlocation = Entities:FindByName ( nil, WaypointName )
	local zombie_7 = CreateUnitByName(unit_name, SpawnLocation:GetAbsOrigin(), true, nil, nil, DOTA_TEAM_BADGUYS)
	zombie_7:SetInitialGoalEntity( waypointlocation )
	zombie_7:AddNewModifier(caster, self, "modifier_zombie", {})
	zombie_7:SetIdleAcquire(false)
	zombie_7:FindAbilityByName("z_7_3_attack"):SetLevel(1)
end

modifier_spawn_7_3_checker = class({})

function modifier_spawn_7_3_checker:IsHidden() return true end
function modifier_spawn_7_3_checker:OnCreated()
	self:StartIntervalThink(0.2)
end
function modifier_spawn_7_3_checker:OnIntervalThink()
if IsServer() then
	if self:GetParent():IsStunned() and self:GetAbility():GetAutoCastState() == true then -- если томба застанена то 
		self:GetAbility():ToggleAutoCast() -- выключить автоспавн говнарей
		return
	end
	local ability = self:GetAbility()
	if ability:GetAutoCastState() == true then
		local gold_cast = ability:GetGoldCost(1)
		local owner = self:GetParent():GetOwner()
		if owner == nil then return end
		local owner_gold = owner:GetGold()
		if ability:IsCooldownReady() and owner_gold>=gold_cast then
			ability:OnSpellStart()
			ability:UseResources(false, false, true, true)
		end
	end
end
end



-------------------------------- ATTACKER 7 SPELL ----------------------

z_7_3_attack = class({})

function z_7_3_attack:GetIntrinsicModifierName()
	return "z_modifier_7_3_attacks"
end

z_modifier_7_3_attacks = class({})

function z_modifier_7_3_attacks:IsHidden() return true end
function z_modifier_7_3_attacks:IsBuff() return true end

function z_modifier_7_3_attacks:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_EVENT_ON_ATTACK_START
	}
end
function z_modifier_7_3_attacks:OnAttackStart(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Hero_Magnataur.PreAttack", event.attacker)
	end
end
function z_modifier_7_3_attacks:OnAttackLanded(event)
	if event.attacker:GetTeamNumber() ~= event.target:GetTeamNumber() and event.attacker:HasModifier("modifier_zombie")  and event.attacker==self:GetParent() then
		EmitSoundOn( "Hero_Magnataur.Attack", event.attacker)
	end
end

function z_modifier_7_3_attacks:OnCreated()
	self:StartIntervalThink(0.5)
end 

function z_modifier_7_3_attacks:OnIntervalThink()
if IsServer() then
if self:GetAbility():IsCooldownReady() then
	local has_done = false
	local caster = self:GetParent()
	local targets = FindUnitsInRadius(caster:GetTeamNumber(), caster:GetAbsOrigin(), nil, 400, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_ALL, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES, FIND_FARTHEST, false)
	local lines = pvzGameMode:GetLines()

	for _,target in pairs(targets) do
		if not has_done then
			for i = 1, lines do
				if caster:HasModifier("modifier_line_"..i) and target:HasModifier("modifier_line_"..i) then -- если рядом трава с нужной линии
					if target:HasModifier("modifier_plants") then 		
						has_done = true
					end
				end
			end
		end  
	end

	if has_done then
		EmitSoundOn("Hero_PrimalBeast.Uproar.Vox", caster)
		self:GetAbility():UseResources(false, false, false, true)
		local targets_to_debuff = FindUnitsInRadius(caster:GetTeamNumber(), caster:GetAbsOrigin(), nil, FIND_UNITS_EVERYWHERE, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_ALL, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES, FIND_FARTHEST, false)
		local lines = 0

		for _,enemy in pairs(targets_to_debuff) do
			if enemy:HasModifier("modifier_plants") then 		
				enemy:AddNewModifier(enemy, nil, "modifier_fear_scream", {duration = 6})
				caster:StartGesture(ACT_DOTA_SPAWN)
				local nFXIndex = ParticleManager:CreateParticle("particles/units/heroes/hero_lycan/lycan_howl_cast.vpcf", PATTACH_ABSORIGIN_FOLLOW, caster )
				ParticleManager:SetParticleControl( nFXIndex, 1, Vector( 1000, 1, 1000 ) )
				self:AddParticle( nFXIndex, false, false, -1, false, false )	
				if not enemy:HasModifier("modifier_sunflower_1") and enemy:GetUnitName()~="npc_plants_special_2" and enemy:GetUnitName()~="npc_plants_special_5" then
					enemy:AddNewModifier(caster, nil, "modifier_stunned", {duration = 2})
				end
			end

		end  
	end

end
end
end

modifier_fear_scream = class({})

function modifier_fear_scream:IsHidden() return false end
function modifier_fear_scream:IsDebuff() return true end
function modifier_fear_scream:IsPurgable() return true end
function modifier_fear_scream:OnCreated()
	-- body
end
function modifier_fear_scream:DeclareFunctions()
	return {
		MODIFIER_EVENT_ON_ATTACK_LANDED,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE_MIN,
		MODIFIER_PROPERTY_MOVESPEED_ABSOLUTE,
		MODIFIER_PROPERTY_IGNORE_MOVESPEED_LIMIT,
		MODIFIER_PROPERTY_PHYSICAL_ARMOR_BONUS
	}
end
function modifier_fear_scream:GetModifierPhysicalArmorBonus() return -5 end


modifier_tombestone_cd = class({})
function modifier_tombestone_cd:IsHidden() return false end
